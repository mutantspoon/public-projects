# CLAUDE.md

## Project Overview

**Quill** - A lightweight, cross-platform WYSIWYG markdown editor built with Tauri (Rust) and Milkdown.

## Tech Stack

- **GUI**: Tauri 2.x (native OS WebView via WebView2 on Windows, WebKit on macOS)
- **Backend**: Rust (src-tauri/src/main.rs)
- **Editor**: Milkdown (WYSIWYG markdown editor)
- **Build**: esbuild (JavaScript bundling)
- **Distribution**: `cargo tauri build` → native .exe (Windows), .app (macOS), ~10MB binary

## Architecture

```
┌─────────────────────────────────────────────┐
│  Tauri Window (Native OS WebView)           │
│  ┌───────────────────────────────────────┐  │
│  │  HTML/CSS/JS UI                       │  │
│  │  ┌─────────────────────────────────┐  │  │
│  │  │  Toolbar (HTML)                 │  │  │
│  │  ├─────────────────────────────────┤  │  │
│  │  │  Milkdown Editor                │  │  │
│  │  │  (WYSIWYG Markdown)             │  │  │
│  │  ├─────────────────────────────────┤  │  │
│  │  │  Status Bar (HTML)              │  │  │
│  │  └─────────────────────────────────┘  │  │
│  └───────────────────────────────────────┘  │
└─────────────────────────────────────────────┘
        ↕ invoke() / Tauri events
┌─────────────────────────────────────────────┐
│  Rust Backend (src-tauri/src/main.rs)       │
│  - File operations (open, save)             │
│  - Settings persistence (settings.json)     │
│  - Window management + title updates        │
│  - Native dialogs (tauri-plugin-dialog)     │
└─────────────────────────────────────────────┘
```

## Project Structure

```
Quill/
├── src-tauri/
│   ├── Cargo.toml           # Rust deps (tauri 2, tauri-plugin-dialog, serde)
│   ├── build.rs             # tauri-build
│   ├── tauri.conf.json      # Window config, file associations, bundle settings
│   ├── capabilities/
│   │   └── default.json     # Tauri permission system
│   ├── icons/
│   │   └── icon.ico         # Windows icon (placeholder; regenerate with tauri icon)
│   └── src/
│       └── main.rs          # All Rust commands + app state
├── ui/
│   ├── index.html           # Main HTML shell
│   ├── css/
│   │   ├── app.css          # App styles
│   │   └── themes.css       # Light/dark theme variables
│   ├── js/
│   │   ├── app.js           # Main JS entry
│   │   ├── editor.js        # Milkdown setup
│   │   ├── toolbar.js       # Toolbar logic
│   │   ├── bridge.js        # Tauri invoke() bridge (was PyWebView API)
│   │   ├── tabs.js          # Multi-tab management
│   │   ├── find.js          # Find & replace
│   │   ├── autosave.js      # Draft autosave
│   │   ├── outline.js       # Document outline
│   │   ├── toast.js         # Toast notifications
│   │   ├── dialog.js        # In-app modal dialogs
│   │   └── bundle.js        # Built bundle (generated by esbuild)
│   └── package.json         # JS deps including @tauri-apps/api
└── assets/
    └── *.png                # Mockup screenshots
```

## Key Shortcuts

| Action | macOS | Windows |
|--------|-------|---------|
| Save | Cmd+S | Ctrl+S |
| Save As | Cmd+Shift+S | Ctrl+Shift+S |
| New | Cmd+N | Ctrl+N |
| Open | Cmd+O | Ctrl+O |
| Bold | Cmd+B | Ctrl+B |
| Italic | Cmd+I | Ctrl+I |
| Link | Cmd+K | Ctrl+K |
| Strikethrough | Cmd+Shift+X | Ctrl+Shift+X |
| Heading 1-3 | Cmd+1/2/3 | Ctrl+1/2/3 |
| Bullet List | Cmd+Shift+8 | Ctrl+Shift+8 |
| Toggle Source | Cmd+/ | Ctrl+/ |
| Word Wrap | Alt+Z | Alt+Z |

## Color Schemes

**Light**: bg #FFFFFF, text #1A1A1A, accent #0066CC
**Dark**: bg #1E1E1E, text #D4D4D4, accent #4FC3F7

## Development

```bash
# First time JS setup
cd ui
npm install

# Build JS bundle (required before running Tauri)
cd ui
npm run build

# Run app in dev mode (from Quill/ root)
cargo tauri dev

# Or: build JS + launch Tauri in one command (from ui/)
npm run tauri:dev

# Watch JS for hot JS reloading (in one terminal)
cd ui && npm run watch
# Then in another terminal:
cargo tauri dev

# Production build
cargo tauri build
# Output: src-tauri/target/release/bundle/
```

## Tauri Bridge (JS → Rust)

JS calls Rust commands via `invoke()`:

```javascript
// bridge.js — all functions delegate to invoke()
import { invoke } from '@tauri-apps/api/core';

export async function openFile() {
    return invoke('open_file');  // shows native dialog, returns {success, content, path}
}
```

Rust commands (src-tauri/src/main.rs):
```rust
#[tauri::command]
fn open_file(app: AppHandle, state: State<'_, SharedState>) -> serde_json::Value {
    // show dialog via tauri-plugin-dialog, read file, return JSON
}
```

## Settings

- **Windows**: `%APPDATA%\Quill\settings.json`
- **macOS**: `~/Library/Application Support/Quill/settings.json`

Settings: `theme`, `font_size`, `word_wrap`, `window_width/height/x/y`, `recent_files`.

## File Associations ("Open with" for .md files)

Configured in `src-tauri/tauri.conf.json` under `bundle.fileAssociations`.

- **Windows**: Registered automatically when Tauri installs the app (requires `cargo tauri build`)
- **macOS**: Handled via `RunEvent::Opened` in `main.rs`, emits `open-file` event to JS

For dev testing: pass a file path as a CLI argument: `cargo tauri dev -- myfile.md`

## Icons

The placeholder `src-tauri/icons/icon.ico` is a minimal transparent 16x16 icon.
To generate proper icons from a square PNG:
```bash
cargo install tauri-cli  # if not installed
cargo tauri icon assets/your-icon.png
```
This generates all required icon sizes in `src-tauri/icons/`.
